import{u as j}from"./list-bec24f07.js";import{u as W}from"./settings-41d6bc6c.js";import{g as B,o as D,a as P,n as F,u as E,b as U,r as T,w as H,c as O,_ as R,s as x,d as q,e as $,f as w,V as z,h as g,i as A,t as I,j as N}from"./index-2bc62442.js";import{V,a as J}from"./VRow-f0c9af65.js";function k(e){return B()?(D(e),!0):!1}function b(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const i=()=>t(o);return k(i),{off:i}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(i=>i(...o)))}}function G(e){return typeof e=="function"?e():E(e)}const K=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Q=Object.prototype.toString,X=e=>Q.call(e)==="[object Object]",Y=()=>{};function Z(e){return e||U()}function ee(e,t=!0,n){const s=Z(n);s?P(e,s):t?e():F(e)}function te(e){var t;const n=G(e);return(t=n==null?void 0:n.$el)!=null?t:n}const L=K?window:void 0;function ne(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=L):[t,n,s,o]=e,!t)return Y;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const i=[],a=()=>{i.forEach(u=>u()),i.length=0},p=(u,r,l,c)=>(u.addEventListener(r,l,c),()=>u.removeEventListener(r,l,c)),S=H(()=>[te(t),G(o)],([u,r])=>{if(a(),!u)return;const l=X(r)?{...r}:r;i.push(...n.flatMap(c=>s.map(m=>p(u,c,m,l))))},{immediate:!0,flush:"post"}),v=()=>{S(),a()};return k(v),v}function oe(){const e=T(!1);return U()&&P(()=>{e.value=!0}),e}function se(e){const t=oe();return O(()=>(t.value,!!e()))}function ie(e={}){const{window:t=L,requestPermissions:n=!0}=e,s=e,o=se(()=>!!t&&"Notification"in t),i=T(o.value&&"permission"in Notification&&Notification.permission==="granted"),a=T(null),p=async()=>{if(o.value)return!i.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(i.value=!0),i.value},{on:S,trigger:v}=b(),{on:u,trigger:r}=b(),{on:l,trigger:c}=b(),{on:m,trigger:C}=b(),_=async d=>{if(!o.value||!i.value)return;const f=Object.assign({},s,d);return a.value=new Notification(f.title||"",f),a.value.onclick=v,a.value.onshow=r,a.value.onerror=c,a.value.onclose=C,a.value},h=()=>{a.value&&a.value.close(),a.value=null};if(n&&ee(p),k(h),o.value&&t){const d=t.document;ne(d,"visibilitychange",f=>{f.preventDefault(),d.visibilityState==="visible"&&h()})}return{isSupported:o,notification:a,ensurePermissions:p,permissionGranted:i,show:_,close:h,onClick:S,onShow:u,onError:l,onClose:m}}const re={__name:"HomeView",setup(e){const t=j(),{currentItem:n,items:s,timeleft:o}=x(t),{setCurrentItem:i,countdown:a,setFinishedItem:p}=t,S=W(),{selectedAlarmFile:v,notify:u}=x(S),r={STOP:0,COUNTING:1,PAUSE:2},l=T(r.STOP);let c=0;const m=()=>{l.value===r.STOP&&s.value.length>0&&i(),l.value=r.COUNTING,c=setInterval(()=>{a(),o.value===0&&_()},1e3)},C=()=>{l.value=r.PAUSE,clearInterval(c)},_=()=>{clearInterval(c),l.value=r.STOP;const f=new Audio;if(f.src=v.value,f.play(),u.value){const{show:y,isSupported:M}=ie({title:"事項完成",body:n.value,icon:new URL(""+new URL("tomato-fe6b03eb.png",import.meta.url).href,self.location).href});M.value&&y()}p(),s.value.length>0&&m()},h=O(()=>n.value.length>0?n.value:s.value.length>0?"點擊開始":"沒有事項"),d=O(()=>{const f=Math.floor(o.value/60).toString().padStart(2,"0"),y=(o.value%60).toString().padStart(2,"0");return f+":"+y});return(f,y)=>(q(),$(z,{class:"container"},{default:w(()=>[g(J,{class:"box"},{default:w(()=>[g(V,{cols:"12"},{default:w(()=>[A("h1",null,I(h.value),1),A("h1",null,I(d.value),1)]),_:1}),g(V,{cols:"12"},{default:w(()=>[g(N,{variant:"text",icon:"mdi-play",disabled:l.value===r.COUNTING,onClick:m},null,8,["disabled"]),g(N,{variant:"text",icon:"mdi-pause",disabled:l.value!==r.COUNTING,onClick:C},null,8,["disabled"]),g(N,{variant:"text",icon:"mdi-skip-next",disabled:E(n).length===0,onClick:_},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}},fe=R(re,[["__scopeId","data-v-9f4d4e5e"]]);export{fe as default};
